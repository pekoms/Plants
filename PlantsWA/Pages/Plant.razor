@page "/Plants"
@using Plants.Api.Domain.Dtos
@using Plants.WA.Services
@using Plants.WA.Shared
@inject NavigationManager NavigationManager
@inject IJSRuntime jsr



    
<MudText Align="Align.Center" Typo="Typo.h4">Mis Plantas</MudText>
<MudPaper Class="pa-16 ma-2" Elevation="3">
    @if (plants == null && plants.Any())
    {
        <MudProgressLinear Color="Color.Secondary" Indeterminate="true" Class="my-7" />
    }else{

        @foreach (var data in plants)
        {      
          <MudStack Justify="Justify.Center" Row="true">
          <MudCard Class="mx-auto pa-6">
            <MudCardMedia Image="@data.Foto" Height="300" />
            <MudCardContent>
                <MudText Typo="Typo.h5">@data.Nombre</MudText>
                <MudText Typo="Typo.body2">@data.Especie.</MudText>                
            </MudCardContent>
            <MudCardActions>
                <MudButton OnClick="@(()=>Observar(data.Id))" Variant="Variant.Text" Color="Color.Primary">Observar</MudButton>                
            </MudCardActions>
        </MudCard>
        </MudStack>
        }
        <MudContainer Class="d-flex justify-start">
            <MudFab OnClick="@(()=>NuevaPlanta())" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.Add" Size="Size.Large" />
        </MudContainer>
    }
    
    </MudPaper>
<MudContainer Class="d-flex justify-end flex-grow-1 gap-4 mt-1">
   <LoggoutBtn></LoggoutBtn>
</MudContainer>
  
    


@code {
    [Parameter]
    public List<PlantDTO> plants { get; set; } = new List<PlantDTO>();
    [Inject]
    public IPlantService PlantService { get; set; }
    private string user;
    private string token;


    protected override async Task OnInitializedAsync()
    {
        token = await jsr.InvokeAsync<string>("localStorage.getItem", "jwtToken");
        user = await jsr.InvokeAsync<string>("localStorage.getItem", "name");
        plants = await PlantService.GetAllPlantsByUserId(user,token);
        
    }
    
    public void Observar(string? Id)
    {
        NavigationManager.NavigateTo($"PlantRecord/{Id}");
    }

    private void NuevaPlanta()
    {
        NavigationManager.NavigateTo("newPlant");
    }
}
